<!-- one.upload https://u1.linnk.it/qc8sbw/usr/apps/textsync/files/bridgetest -->
<!doctype html>
<html>
<head>
<style type='text/css'>
h1 {
	color: red;
}
</style>
</head>
<body>
	<h1>Javascript Bridge Demo</h1>
	
	<script
		src="http://appjangle.com/js/v01/appjangle/appjangle.nocache.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


	<script>
  document.addEventListener('WebViewJavascriptBridgeReady', onBridgeReady, false);
  
 
  window.onNextwebOnedb = function() {
	  var session = Nextweb.createSession();
      session.node("http://slicnet.com/seed1/seed1/5/3/9/8/h/sd").get(function(node) {
    	  $('body').append('<p>Test Call [' +node.value() + ']</p>');
    	  
    	  session.close().get(function() {});
      });
      
  };
  
  
 
  function onBridgeReady() {
	 
	  WebViewJavascriptBridge.registerJsCallback('testJsCallback', function(params) {
          var el = document.body.appendChild(document.createElement('div'));
          el.innerHTML = 'JS Callback called foo is [' + params.foo + ']';
          
          var session = Nextweb.createSession();
          
          session.node("http://slicnet.com/seed1/seed1/5/3/9/8/h/sd").get(function(node) {
              var el = document.body.appendChild(document.createElement('div'));
              el.innerHTML = '1 received response '+node.value();
              WebViewJavascriptBridge.callObjcCallback('testObjcCallback', {'foo': node.value()}); 
          });
          
      });

      WebViewJavascriptBridge.setMessageHandler(function(message) {
          var el = document.body.appendChild(document.createElement('div'));
          el.innerHTML = message;
          
          var session = Nextweb.createSession();
          
          session.node("http://slicnet.com/seed1/seed1/5/3/9/8/h/sd").get(function(node) {
              var el = document.body.appendChild(document.createElement('div'));
              el.innerHTML = '2 received response '+node.value();
              WebViewJavascriptBridge.callObjcCallback('testObjcCallback', {'foo': node.value()}); 
          });
      });
      WebViewJavascriptBridge.sendMessage('hello from the JS');

      var button = document.body.appendChild(document.createElement('button'));
      button.innerHTML = 'Click me to send a message to ObjC';
      button.onclick = button.ontouchstart = function() { WebViewJavascriptBridge.sendMessage('hello from JS button'); };

      document.body.appendChild(document.createElement('br'));

      var callbackButton =$("<button>Click me to call ObjC callback</button>").appendTo('body');
      callbackButton.click(function(evt) { 
        
         var el = document.body.appendChild(document.createElement('div'));
         el.innerHTML = 'click received';
         if (false) {
             var el = document.body.appendChild(document.createElement('div'));
             el.innerHTML = 'Nextweb not loaded';
              WebViewJavascriptBridge.callObjcCallback('testObjcCallback', {'foo': 'bar'}); 
          } else {
              var el = document.body.appendChild(document.createElement('div'));
              el.innerHTML = 'send request';
              var session = Nextweb.createSession();
             
              session.node("http://slicnet.com/seed1/seed1/5/3/9/8/h/sd").get(function(node) {
                  var el = document.body.appendChild(document.createElement('div'));
                  el.innerHTML = '3 received response '+node.value();
                  WebViewJavascriptBridge.callObjcCallback('testObjcCallback', {'foo': node.value()}); 
              });
          }
          
     
      });
      
      
  }
  </script>
</body>
</html>

<!-- one.end -->
